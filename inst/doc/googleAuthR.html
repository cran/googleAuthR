<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Mark Edmondson" />

<meta name="date" content="2015-08-19" />

<title>googleAuthR</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">googleAuthR</h1>
<h4 class="author"><em>Mark Edmondson</em></h4>
<h4 class="date"><em>2015-08-19</em></h4>
</div>


<div id="googleauthr---google-api-client-library-for-r" class="section level1">
<h1>googleAuthR - Google API Client Library for R</h1>
<p>Build libraries for Google APIs with OAuth2 for both local and Shiny app use.</p>
<p>Here is a list of <a href="https://developers.google.com/apis-explorer/#p/">available Google APIs.</a></p>
<div id="install" class="section level2">
<h2>Install</h2>
<pre class="sourceCode r"><code class="sourceCode r">## load the library or download it if necessary
if(!<span class="kw">require</span>(googleAuthR)){
  if(!<span class="kw">require</span>(devtools)){
    <span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
  } else {
    devtools::<span class="kw">install_github</span>(<span class="st">&quot;MarkEdmondson1234/googleAuthR&quot;</span>)
  }
}
<span class="kw">library</span>(googleAuthR)</code></pre>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The main two functions are <code>gar_auth()</code> and <code>gar_api_generator()</code>.</p>
<div id="gar_auth" class="section level3">
<h3><code>gar_auth</code></h3>
<p>This takes care of getting the authentication token, storing it and refreshing. Use it before any call to a Google library.</p>
</div>
<div id="gar_api_generator" class="section level3">
<h3><code>gar_api_generator</code></h3>
<p>This creates functions for you to use to interact with Google APIs. Use it within your own function definitions, to query the Google API you want.</p>
</div>
</div>
<div id="google-api-setup" class="section level2">
<h2>Google API Setup</h2>
<p><code>googleAuthR</code> has a default project setup with APIs activated for several APIs, but it is recommended you use your own Client IDs as the login screen will be big and scary for users with so many APIs to approve.</p>
<p>It is preferred to configure your functions to only use the scopes they need.</p>
<p>Set scopes via the option <code>googleAuthR.scopes.selected</code>.</p>
<p>The below example sets scopes for Search Console, Google Analytics and Tag Manager:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="st">&quot;googleAuthR.scopes.selected&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;https://www.googleapis.com/auth/webmasters&quot;</span>,
                                          <span class="st">&quot;https://www.googleapis.com/auth/analytics&quot;</span>,
                                          <span class="st">&quot;https://www.googleapis.com/auth/tagmanager.readonly&quot;</span>))</code></pre>
<p>A non-definitive scope list to choose from will be attempted to be maintained via <code>getOption(&quot;googleAuthR.scopes&quot;)</code></p>
<div id="set-up-steps" class="section level3">
<h3>Set up steps</h3>
<ol style="list-style-type: decimal">
<li>Set up your project in the <a href="https://code.google.com/apis/console">Google API Console</a> to use the search console v3 API.</li>
</ol>
<div id="for-local-use" class="section level4">
<h4>For local use</h4>
<ol start="2" style="list-style-type: decimal">
<li>Click ‘Create a new Client ID’, and choose “Installed Application”.</li>
<li>Note your Client ID and secret.</li>
<li>Modify these options after <code>googleAuthR</code> has been loaded:</li>
</ol>
<ul>
<li><code>options(&quot;googleAuthR.client_id&quot; = &quot;YOUR_CLIENT_ID&quot;)</code></li>
<li><code>options(&quot;googleAuthR.client_secret&quot; = &quot;YOUR_CLIENT_SECRET&quot;)</code></li>
</ul>
</div>
<div id="for-shiny-use" class="section level4">
<h4>For Shiny use</h4>
<ol start="2" style="list-style-type: decimal">
<li>Click ‘Create a new Client ID’, and choose “Web Application”.</li>
<li>Note your Client ID and secret.</li>
<li>Add the URL of where your Shiny app will run, as well as your local host for testing including a port number. e.g. <code>https://mark.shinyapps.io/searchConsoleRDemo/</code> and <code>http://127.0.0.1:4624</code></li>
<li>In your Shiny script modify these options:</li>
</ol>
<ul>
<li><code>options(&quot;googleAuthR.webapp.client_id&quot; = &quot;YOUR_CLIENT_ID&quot;)</code></li>
<li><code>options(&quot;googleAuthR.webapp.client_secret&quot; = &quot;YOUR_CLIENT_SECRET&quot;)</code></li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>Run the app locally specifying the port number you used e.g. <code>shiny::runApp(port=4624)</code></li>
<li>Or deploy to your Shiny Server that deploys to web port (80 or 443).</li>
</ol>
</div>
<div id="activate-api" class="section level4">
<h4>Activate API</h4>
<ol style="list-style-type: decimal">
<li>Click on “APIs”</li>
<li>Select and activate the API you want to use.</li>
<li>Go to the documentation and find the API scope URL</li>
<li>Set option in your R script for the scope e.g.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="st">&quot;googleAuthR.scopes.selected&quot;</span> =<span class="st"> </span>
<span class="st">      </span><span class="kw">c</span>(<span class="st">&quot;https://www.googleapis.com/auth/urlshortener&quot;</span>))</code></pre>
</div>
</div>
</div>
<div id="building-your-own-functions" class="section level2">
<h2>Building your own functions</h2>
<p>If the above is successful, then you should go through the Google login flow in your browser when you run this command:</p>
<pre class="sourceCode r"><code class="sourceCode r">googleAuthR::<span class="kw">gar_auth</span>()</code></pre>
<p>If you ever need to authenticate with a new user, use:</p>
<pre class="sourceCode r"><code class="sourceCode r">googleAuthR::<span class="kw">gar_auth</span>(<span class="dt">new_user=</span><span class="ot">TRUE</span>)</code></pre>
<p>Authentication token is cached in a hidden file called <code>.httr-oauth</code> in the working directory.</p>
<div id="authentication-with-no-browser" class="section level3">
<h3>Authentication with no browser</h3>
<p>If for some reason you need authentication without access to a browser (for example when using Shiny Server), then you can authenticate locally and upload the <code>.httr-oauth</code> file to the folder of your script.</p>
</div>
<div id="authentication-with-shiny" class="section level3">
<h3>Authentication with Shiny</h3>
<p>If you want to create a Shiny app just using your data, upload the app with your own <code>.httr-oauth</code>.</p>
<p>If you want to make a multi-user Shiny app, where users login to their own Google account and the app works with their data, read on:</p>
<p>googleAuthR provides these functions to help make the Google login process as easy as possible:</p>
<ul>
<li><code>loginOutput()</code> - creates the client side login button for users to authenticate with.</li>
<li><code>renderLogin()</code> - creates the server side login button for users to authenticate with.</li>
<li><code>reactiveAccessToken()</code> - creates the user’s authentication token.</li>
<li><code>with_shiny()</code> - wraps your API functions so they can be passed the user’s authentication token.</li>
</ul>
<div id="shiny-authentication-example" class="section level4">
<h4>Shiny authentication example</h4>
<pre class="sourceCode r"><code class="sourceCode r">## in server.R
<span class="kw">library</span>(shiny)
<span class="kw">library</span>(googleAuthR)

<span class="kw">shinyServer</span>(function(input, output, session){
 
   ## Get auth code from return URL
   access_token  &lt;-<span class="st"> </span><span class="kw">reactiveAccessToken</span>(session)
 
   ## Make a loginButton to display using loginOutput
   output$loginButton &lt;-<span class="st"> </span><span class="kw">renderLogin</span>(session, <span class="kw">access_token</span>())

   your_api_function &lt;-<span class="st"> </span><span class="kw">eventReactive</span>(input$submit, {
     ## with_shiny() wraps your your_api_function to provide the arguments
     ## requires you to pass &quot;shiny_access_token&quot;
     short_url &lt;-<span class="st"> </span><span class="kw">with_shiny</span>(<span class="dt">f =</span> your_api_function, 
                             <span class="dt">shiny_access_token =</span> <span class="kw">access_token</span>(),
                             <span class="dt">arg1=</span>input$url,
                             <span class="dt">arg2=</span>input2)
     
     
   })
   
   output$short_url &lt;-<span class="st"> </span><span class="kw">renderText</span>({

    <span class="kw">short_url_output</span>()
     
    })

})

## in ui.R
<span class="kw">library</span>(shiny)
<span class="kw">library</span>(googleAuthR)

<span class="kw">shinyUI</span>(
  <span class="kw">fluidPage</span>(
 <span class="kw">loginOutput</span>(<span class="st">&quot;loginButton&quot;</span>),
   <span class="kw">textInput</span>(<span class="st">&quot;url&quot;</span>, <span class="st">&quot;Enter URL&quot;</span>),
   <span class="kw">actionButton</span>(<span class="st">&quot;submit&quot;</span>, <span class="st">&quot;Shorten URL&quot;</span>),
   <span class="kw">textOutput</span>(<span class="st">&quot;short_url&quot;</span>)
   ))</code></pre>
</div>
</div>
</div>
<div id="generating-your-function" class="section level2">
<h2>Generating your function</h2>
<p>Creating your own API should then be a matter of consulting the Google API documentation, and filling in the required details.</p>
<p><code>gar_api_generator</code> has these components:</p>
<ul>
<li><code>baseURI</code> - all APIs have a base for every API call</li>
<li><code>http_header</code> - what type of request, most common are GET and POST</li>
<li><code>path_args</code> - some APIs need you to alter the URL folder structure when calling, e.g. <code>/account/{accountId}/</code> where <code>accountId</code> is variable.</li>
<li><code>pars_args</code> - other APIS require you to send URL parameters e.g. <code>?account={accountId}</code> where <code>accountId</code> is variable.</li>
<li><code>data_parse_function</code> - [optional] If the API call returns data, it will be available in <code>$content</code>. You can create a parsing function that transforms it in to something you can work with (for instance, a dataframe)</li>
</ul>
<p>Example below for generating a function:</p>
<pre class="sourceCode r"><code class="sourceCode r">  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>,
                         <span class="dt">data_parse_function =</span> function(x) x$id)</code></pre>
</div>
<div id="using-your-generated-function" class="section level2">
<h2>Using your generated function</h2>
<p>The function generated uses <code>path_args</code> and <code>pars_args</code> to create a template, but when the function is called you will want to pass dynamic data to them. This is done via the <code>path_arguments</code> and <code>pars_arguments</code> parameters.</p>
<p><code>path_args</code> and <code>pars_args</code> and <code>path_arguments</code> and <code>pars_arguments</code> all accept named lists.</p>
<p>If a name in <code>path_args</code> is present in <code>path_arguments</code>, then it is substituted in. This way you can pass dynamic parameters to the constructed function. Likewise for <code>pars_args</code> and <code>pars_arguments</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">## Create a function that requires a path argument /accounts/{accountId}
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/example&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>,
                         <span class="dt">path_args =</span> <span class="kw">list</span>(<span class="dt">accounts =</span> <span class="st">&quot;defaultAccountId&quot;</span>)
                         <span class="dt">data_parse_function =</span> function(x) x$id)
                             
## When using f(), pass the path_arguments function to it 
## with the same name to modify &quot;defaultAccountId&quot;:

  result &lt;-<span class="st"> </span><span class="kw">f</span>(<span class="dt">path_arguments =</span> <span class="kw">list</span>(<span class="dt">accounts =</span> <span class="st">&quot;myAccountId&quot;</span>))
</code></pre>
<div id="body-data" class="section level3">
<h3>Body data</h3>
<p>A lot of Google APIs look for you to send data in the Body of the request. This is done after you construct the function.</p>
<p><code>googleAuthR</code> uses <code>httr</code>’s JSON parsing via <code>jsonlite</code> to construct JSON from R lists.</p>
<p>Construct your list, then use <code>jsonlite::toJSON</code> to check if its in the correct format as specified by the Google documentation. This is often the hardest part using the API.</p>
</div>
<div id="parsing-data" class="section level3">
<h3>Parsing data</h3>
<p>Not all API calls return data, but if they do:</p>
<p>If you have no <code>data_parse_function</code> then the function returns the whole request object. The content is available in <code>$content</code>. You can then parse this yourself, or pass a function in to do it for you.</p>
<p>If you parse in a function into <code>data_parse_function</code>, it works on the response’s <code>$content</code>.</p>
<p>Example below of the differences between having a data parsing function and not:</p>
<pre class="sourceCode r"><code class="sourceCode r">  ## the body object that will be passed in
  body =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">longUrl =</span> <span class="st">&quot;http://www.google.com&quot;</span>
  )
  
  ## no data parsing function
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>)
                         
  no_parse &lt;-<span class="st"> </span><span class="kw">f</span>(<span class="dt">the_body =</span> body)
  
  ## parsed data, only taking request$content$id
  f2 &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                          <span class="st">&quot;POST&quot;</span>,
                          <span class="dt">data_parse_function =</span> function(x) x$id)
  
  parsed &lt;-<span class="st"> </span><span class="kw">f2</span>(<span class="dt">the_body =</span> body)
  
  ## str(no_parse) has full details of API response.
  ## just looking at no_parse$content as this is what API returns
  &gt;<span class="st"> </span><span class="kw">str</span>(no_parse$content)
  List of <span class="dv">3</span>
   $<span class="st"> </span>kind   :<span class="st"> </span>chr <span class="st">&quot;urlshortener#url&quot;</span>
   $<span class="st"> </span>id     :<span class="st"> </span>chr <span class="st">&quot;http://goo.gl/ZwT9pG&quot;</span>
   $<span class="st"> </span>longUrl:<span class="st"> </span>chr <span class="st">&quot;http://www.google.com/&quot;</span>
 
  ## compare to the above - equivalent to no_parse$content$id 
  &gt;<span class="st"> </span><span class="kw">str</span>(parsed)
   chr <span class="st">&quot;http://goo.gl/mCYw2i&quot;</span>
                             </code></pre>
<p>The response is turned from JSON to a dataframe if possible, via <code>jsonlite::fromJSON</code></p>
</div>
<div id="putting-it-together" class="section level3">
<h3>Putting it together</h3>
<p>Below is an example for a link shortner API call to goo.gl:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' Shortens a url using goo.gl</span>
<span class="co">#'</span>
<span class="co">#' @param url URl to shorten with goo.gl</span>
<span class="co">#' </span>
<span class="co">#' @return a string of the short URL</span>
<span class="co">#'</span>
<span class="co">#' Documentation: https://developers.google.com/url-shortener/v1/getting_started</span>

## a wrapper for the function that users pass in the URL to shorten
shorten_url &lt;-<span class="st"> </span>function(url){
  
  ## turns into {'longUrl' : '&lt;&lt;example.com&gt;&gt;'} when using jsonlite::toJSON(body)
  body =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">longUrl =</span> url
  )
  
  ## generate the API call function
  ## POST https://www.googleapis.com/urlshortener/v1/url
  ## response has 4 objects $kind, $id, $longUrl, and $status, but we only want $id
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>,
                         <span class="dt">data_parse_function =</span> function(x) x$id)
                             
                             
  ## now the function has been generated, pass in the body.
  ## this function has no need for path_arguments or pars_arguments, 
  ## but that will differ for other APIs.
  <span class="kw">f</span>(<span class="dt">the_body =</span> body)
  
}

## to use:

<span class="kw">gar_auth</span>()
<span class="kw">shorten_url</span>(<span class="st">&quot;http://www.google.com&quot;</span>)</code></pre>
</div>
<div id="using-with-shiny" class="section level3">
<h3>Using with Shiny</h3>
<p>If you want to create a Shiny app just using your data, upload the app with your own <code>.httr-oauth</code>.</p>
<p>If you want to make a multi-user Shiny app, where users login to their own Google account and the app works with their data, googleAuthR provides these functions to help make the Google login process as easy as possible:</p>
<ul>
<li><code>loginOutput()</code> - creates the client side login button for users to authenticate with.</li>
<li><code>renderLogin()</code> - creates the server side login button for users to authenticate with.</li>
<li><code>reactiveAccessToken()</code> - creates the user’s authentication token.</li>
<li><code>with_shiny()</code> - wraps your API functions so they can be passed the user’s authentication token.</li>
</ul>
<div id="shiny-authentication-example-1" class="section level4">
<h4>Shiny authentication example</h4>
<pre class="sourceCode r"><code class="sourceCode r">## in global.R
<span class="kw">library</span>(googleAuthR)
<span class="kw">options</span>(<span class="st">&quot;googleAuthR.scopes.selected&quot;</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;https://www.googleapis.com/auth/urlshortener&quot;</span>))


shorten_url &lt;-<span class="st"> </span>function(url){

  body =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">longUrl =</span> url
  )
  
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>,
                         <span class="dt">data_parse_function =</span> function(x) x$id)
  
  <span class="kw">f</span>(<span class="dt">the_body =</span> body)
  
}


## in server.R
<span class="kw">library</span>(shiny)
<span class="kw">library</span>(googleAuthR)
<span class="kw">source</span>(<span class="st">'global.R'</span>)

<span class="kw">shinyServer</span>(function(input, output, session){
 
   ## Get auth code from return URL
   access_token  &lt;-<span class="st"> </span><span class="kw">reactiveAccessToken</span>(session)
 
   ## Make a loginButton to display using loginOutput
   output$loginButton &lt;-<span class="st"> </span><span class="kw">renderLogin</span>(session, <span class="kw">access_token</span>())

   short_url_output &lt;-<span class="st"> </span><span class="kw">eventReactive</span>(input$submit, {
     ## wrap existing function with_shiny
     ## pass the reactive token in shiny_access_token
     ## pass other named arguments
     short_url &lt;-<span class="st"> </span><span class="kw">with_shiny</span>(<span class="dt">f =</span> shorten_url, 
                             <span class="dt">shiny_access_token =</span> <span class="kw">access_token</span>(),
                             <span class="dt">url=</span>input$url)
     
     
   })
   
   output$short_url &lt;-<span class="st"> </span><span class="kw">renderText</span>({

    <span class="kw">short_url_output</span>()
     
    })

})

## in ui.R
<span class="kw">library</span>(shiny)
<span class="kw">library</span>(googleAuthR)

<span class="kw">shinyUI</span>(
  <span class="kw">fluidPage</span>(
 <span class="kw">loginOutput</span>(<span class="st">&quot;loginButton&quot;</span>),
   <span class="kw">textInput</span>(<span class="st">&quot;url&quot;</span>, <span class="st">&quot;Enter URL&quot;</span>),
   <span class="kw">actionButton</span>(<span class="st">&quot;submit&quot;</span>, <span class="st">&quot;Shorten URL&quot;</span>),
   <span class="kw">textOutput</span>(<span class="st">&quot;short_url&quot;</span>)
   ))</code></pre>
</div>
</div>
<div id="more-info" class="section level3">
<h3>More info</h3>
<p>See more at <code>?gar_api_generator</code> once the documentation has caught up.</p>
</div>
</div>
<div id="example-with-goo.gl" class="section level2">
<h2>Example with goo.gl</h2>
<p>Below is an example building a link shortner R package using <code>googleAuthR</code>.</p>
<p>It was done referring to the <a href="https://developers.google.com/url-shortener/v1/getting_started">documentation for Google URL shortener</a>.</p>
<p>Note the help docs specifies the steps outlined above. These are in general the steps for every Google API.</p>
<ol style="list-style-type: decimal">
<li>Creating a project</li>
<li>Activate API</li>
<li>Provide scope</li>
<li>Specify the base URL (in this case <code>https://www.googleapis.com/urlshortener/v1/url</code>)</li>
<li>Specify the httr request type e.g. <code>POST</code></li>
<li>Constructing a body request</li>
<li>Giving the response format</li>
</ol>
<div id="example-goo.gl-r-library" class="section level3">
<h3>Example goo.gl R library</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)

## change the native googleAuthR scopes to the one needed.
<span class="kw">options</span>(<span class="st">&quot;googleAuthR.scopes.selected&quot;</span> =<span class="st"> </span>
<span class="st">        </span><span class="kw">c</span>(<span class="st">&quot;https://www.googleapis.com/auth/urlshortener&quot;</span>))

<span class="co">#' Shortens a url using goo.gl</span>
<span class="co">#'</span>
<span class="co">#' @param url URl to shorten with goo.gl</span>
<span class="co">#' </span>
<span class="co">#' @return a string of the short URL</span>
shorten_url &lt;-<span class="st"> </span>function(url){
  
  body =<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">longUrl =</span> url
  )
  
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;POST&quot;</span>,
                         <span class="dt">data_parse_function =</span> function(x) x$id)
  
  <span class="kw">f</span>(<span class="dt">the_body =</span> body)
  
}

<span class="co">#' Expands a url that has used goo.gl</span>
<span class="co">#'</span>
<span class="co">#' @param shortUrl Url that was shortened with goo.gl</span>
<span class="co">#' </span>
<span class="co">#' @return a string of the expanded URL</span>
expand_url &lt;-<span class="st"> </span>function(shortUrl){
  
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;GET&quot;</span>,
                         <span class="dt">pars_args =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> <span class="st">&quot;shortUrl&quot;</span>),
                         <span class="dt">data_parse_function =</span> function(x) x)
                         
  <span class="kw">f</span>(<span class="dt">pars_arguments =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> shortUrl))
  
}

<span class="co">#' Get analyitcs of a url that has used goo.gl</span>
<span class="co">#'</span>
<span class="co">#' @param shortUrl Url that was shortened with goo.gl</span>
<span class="co">#' @param timespan The time period for the analytics data</span>
<span class="co">#' </span>
<span class="co">#' @return a dataframe of the goo.gl Url analytics</span>
analytics_url &lt;-<span class="st"> </span>function(shortUrl, 
                          <span class="dt">timespan =</span> <span class="kw">c</span>(<span class="st">&quot;allTime&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;week&quot;</span>,<span class="st">&quot;day&quot;</span>,<span class="st">&quot;twoHours&quot;</span>)){
  
  timespan &lt;-<span class="st"> </span><span class="kw">match.arg</span>(timespan)
    
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url&quot;</span>,
                         <span class="st">&quot;GET&quot;</span>,
                         <span class="dt">pars_args =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> <span class="st">&quot;shortUrl&quot;</span>,
                                          <span class="dt">projection =</span> <span class="st">&quot;FULL&quot;</span>),
                         <span class="dt">data_parse_function =</span> function(x) { 
                                    a &lt;-<span class="st"> </span>x$analytics 
                                    <span class="kw">return</span>(a[timespan][[<span class="dv">1</span>]])
                                    })
  
  <span class="kw">f</span>(<span class="dt">pars_arguments =</span> <span class="kw">list</span>(<span class="dt">shortUrl =</span> shortUrl))
}

<span class="co">#' Get the history of the authenticated user</span>
<span class="co">#' </span>
<span class="co">#' @return a dataframe of the goo.gl user's history</span>
user_history &lt;-<span class="st"> </span>function(){
  f &lt;-<span class="st"> </span><span class="kw">gar_api_generator</span>(<span class="st">&quot;https://www.googleapis.com/urlshortener/v1/url/history&quot;</span>,
                         <span class="st">&quot;GET&quot;</span>,
                         <span class="dt">data_parse_function =</span> function(x) x$items)
  
  <span class="kw">f</span>()
}</code></pre>
<p>To use the above functions:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(googleAuthR)

<span class="co"># got through authentication flow</span>
<span class="kw">gar_auth</span>()

s &lt;-<span class="st"> </span><span class="kw">shorten_url</span>(<span class="st">&quot;http://markedmondson.me&quot;</span>)
s

<span class="kw">expand_url</span>(s)

<span class="kw">analytics_url</span>(s, <span class="dt">timespan =</span> <span class="st">&quot;month&quot;</span>)

<span class="kw">user_history</span>()</code></pre>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
